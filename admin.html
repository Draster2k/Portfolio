<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Azar | Admin Dashboard</title>
    <link rel="stylesheet" href="styles.css"> 
    <style>
        .admin-wrap { padding: 40px; max-width: 1100px; margin: 60px auto; }
        .stats-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 30px; }
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 20px; color: #cbd5e1; }
        th { text-align: left; padding: 12px; color: #0EA5E9; border-bottom: 2px solid rgba(14, 165, 233, 0.3); }
        td { padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); font-size: 14px; }
        .loc-tag { color: #10B981; font-weight: bold; } /* Emerald Green for Location */
        .org-tag { color: #F59E0B; } /* Amber for Company */
    </style>
</head>
<body class="glass">
    <div class="admin-wrap">
        <div class="stats-card">
            <h1 style="color: white; margin-bottom: 20px;">Recruiter Tracker</h1>
            <div style="margin-bottom: 30px;">
                <input type="password" id="admin-key" placeholder="Enter Secret Key..." style="background: rgba(0,0,0,0.2); border: 1px solid #0EA5E9; color: white; padding: 10px; border-radius: 10px; outline: none;">
                <button onclick="fetchLogs()" class="action-btn">Unlock Analytics</button>
            </div>

            <div id="dashboard-content" style="display: none;">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Time (UTC)</th>
                            <th>City/Country</th>
                            <th>Organization (Company)</th>
                            <th>What they asked</th>
                        </tr>
                    </thead>
                    <tbody id="log-rows"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        async function fetchLogs() {
            const key = document.getElementById('admin-key').value;
            const content = document.getElementById('dashboard-content');
            const tableBody = document.getElementById('log-rows');

            try {
                const response = await fetch('https://portfolio-backend-mn66.onrender.com/admin-stats', {
                    method: 'GET',
                    headers: { 
                        'x-admin-token': key.trim() 
                    }
                });

                if (!response.ok) throw new Error("Unauthorized Access");

                const logs = await response.json();
                tableBody.innerHTML = ""; 

                logs.reverse().forEach(log => {
                    tableBody.innerHTML += `
                        <tr>
                            <td>${log.timestamp}</td>
                            <td class="loc-tag">${log.location}</td>
                            <td class="org-tag">${log.company}</td>
                            <td><em>"${log.query}"</em></td>
                        </tr>`;
                });

                content.style.display = "block";
            } catch (err) {
                alert("Incorrect Key.");
            }
        }
    </script>
</body>
</html>